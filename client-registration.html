<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل عميل جديد - WF World</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="index.html" class="navbar-brand">⚡ WF World</a>
            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <ul class="navbar-menu">
                    <li><a href="index.html" class="navbar-link">الرئيسية</a></li>
                    <li><a href="client-registration.html" class="navbar-link active">تسجيل عميل</a></li>
                    <li><a href="sales.html" class="navbar-link">المبيعات</a></li>
                    <li><a href="clients-dashboard.html" class="navbar-link">قائمة العملاء</a></li>
                    <li><a href="client-lookup.html" class="navbar-link">بحث</a></li>
                </ul>
            </div>
    </nav> <button id="theme-toggle-btn" class="theme-toggle" onclick="toggleTheme()" title="تغيير المظهر">☀️</button>
    </div>
    </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding: 2rem 0; max-width: 800px;">
        <div class="card">
            <h1>👤 تسجيل عميل جديد</h1>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                أدخل بيانات العميل الجديد لإنشاء ملف شخصي له في النظام
            </p>

            <form id="client-form">
                <!-- Full Name -->
                <div class="form-group">
                    <label for="fullName" class="form-label">الاسم الكامل *</label>
                    <input type="text" id="fullName" name="fullName" class="form-control"
                        placeholder="أدخل الاسم الكامل" required>
                </div>

                <!-- Email -->
                <div class="form-group">
                    <label for="email" class="form-label">البريد الإلكتروني *</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="example@email.com"
                        required>
                </div>

                <!-- Phone -->
                <div class="form-group">
                    <label for="phone" class="form-label">رقم الهاتف *</label>
                    <input type="tel" id="phone" name="phone" class="form-control" placeholder="+20 123 456 7890"
                        required>
                </div>

                <!-- Country -->
                <div class="form-group">
                    <label for="country" class="form-label">الدولة *</label>
                    <select id="country" name="country" class="form-control" required>
                        <option value="">-- اختر الدولة --</option>
                        <option value="مصر">مصر</option>
                        <option value="السعودية">السعودية</option>
                        <option value="الإمارات">الإمارات</option>
                        <option value="الكويت">الكويت</option>
                        <option value="قطر">قطر</option>
                        <option value="البحرين">البحرين</option>
                        <option value="الأردن">الأردن</option>
                        <option value="لبنان">لبنان</option>
                        <option value="العراق">العراق</option>
                        <option value="فلسطين">فلسطين</option>
                        <option value="سوريا">سوريا</option>
                        <option value="ليبيا">ليبيا</option>
                        <option value="تونس">تونس</option>
                        <option value="الجزائر">الجزائر</option>
                        <option value="المغرب">المغرب</option>
                        <option value="اليمن">اليمن</option>
                        <option value="عُمان">عُمان</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>

                <!-- Religion -->
                <div class="form-group">
                    <label for="religion" class="form-label">الديانة (اختياري)</label>
                    <select id="religion" name="religion" class="form-control">
                        <option value="">-- اختر --</option>
                        <option value="مسلم">مسلم</option>
                        <option value="مسيحي">مسيحي</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                    <small style="color: var(--text-muted); font-size: 0.85rem;">
                        يُستخدم لمراعاة فترات الصيام في الخطط الغذائية
                    </small>
                </div>

                <!-- Client Code Preview -->
                <div class="alert alert-info" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="font-size: 1.25rem;">🎫</span>
                    <div>
                        <strong>كود العميل سيتم توليده تلقائياً</strong><br>
                        <small>سيتم إنشاء رقم تعريفي فريد للعميل بعد التسجيل</small>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="d-flex gap-2" style="margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">
                        ✅ تسجيل العميل
                    </button>
                    <button type="reset" class="btn btn-outline">
                        🔄 مسح الحقول
                    </button>
                    <a href="index.html" class="btn btn-outline">
                        ↩️ العودة للرئيسية
                    </a>
                </div>
            </form>
        </div>

        <!-- Recent Clients -->
        <div class="card mt-4">
            <h3>👥 آخر العملاء المسجلين</h3>
            <div id="recent-clients" style="margin-top: 1rem;">
                <!-- Will be loaded dynamically -->
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script>
        // Form submission handler
        document.getElementById('client-form').addEventListener('submit', function (e) {
            e.preventDefault();

            // Get form data
            const formData = new FormData(this);
            const clientData = {
                fullName: formData.get('fullName').trim(),
                email: formData.get('email').trim(),
                phone: formData.get('phone').trim(),
                country: formData.get('country'),
                religion: formData.get('religion')
            };

            // Validate
            if (!clientData.fullName || !clientData.email || !clientData.phone || !clientData.country) {
                showAlert('يرجى ملء جميع الحقول المطلوبة', 'warning');
                return;
            }

            if (!isValidEmail(clientData.email)) {
                showAlert('البريد الإلكتروني غير صحيح', 'danger');
                return;
            }

            if (!isValidPhone(clientData.phone)) {
                showAlert('رقم الهاتف غير صحيح', 'danger');
                return;
            }

            // Show loading
            showLoading('جاري تسجيل العميل...');

            // Simulate delay for better UX
            setTimeout(() => {
                try {
                    // Add client to database
                    const newClient = db.addClient(clientData);

                    hideLoading();
                    showAlert(`تم تسجيل العميل بنجاح! كود العميل: ${newClient.clientCode}`, 'success');

                    // Reset form
                    this.reset();

                    // Reload recent clients
                    loadRecentClients();

                } catch (error) {
                    hideLoading();
                    showAlert('حدث خطأ أثناء التسجيل: ' + error.message, 'danger');
                }
            }, 500);
        });

        // Load recent clients
        function loadRecentClients() {
            const clients = db.getAllClients().slice(-5).reverse(); // Last 5 clients
            const container = document.getElementById('recent-clients');

            if (clients.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted);">لم يتم تسجيل أي عملاء بعد</p>';
                return;
            }

            container.innerHTML = clients.map(client => `
        <div style="padding: 0.75rem; background: var(--bg-glass); border-radius: var(--radius-md); margin-bottom: 0.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong>${client.fullName}</strong>
              <div style="font-size: 0.85rem; color: var(--text-muted);">
                ${client.email} • ${client.phone}
              </div>
            </div>
            <div style="text-align: left;">
              <span class="badge badge-primary">${client.clientCode}</span>
              <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">
                ${formatDate(client.registrationDate)}
              </div>
            </div>
          </div>
        </div>
      `).join('');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', loadRecentClients);
    </script>
</body>

</html>